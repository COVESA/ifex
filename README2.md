# Documentation development overview

The documentation, [published](https://covesa.github.io/ifex) on GitHub pages, is generated by a combination of tools and steps:

## Tools:

- The [GitHub actions workflow](/.github/workflows/generate_docs.yml) encodes the build steps.
- [markup-markdown](https://github.com/hailiang-wang/markup-markdown) is used to combine several markdown files into one.  Some markdown files are static and stored in [[doc-parts]], whereas some are generated from source files.  The naming convention for the definition files are `*.m.md`
- [ifex_ast_doc.py](../ifex/model/ifex_ast_doc.py) generates the main syntax documentation directly from the datatypes used in the internal model AST.  The language definition for the YAML based IDL represents the internal object model.  In the end, both the program behavior _and the documentation of it_ is defined from the python source definition in [ifex_ast.py](../ifex/model/ifex_ast.py)
- The script [create-toc.py](create-toc.py) is used to generate a Table of Contents for the document.

## Source files:

- [def-specification.stage1.m.md](./def-specification.stage1.m.md).  Lists the parts required to produce the main specification.
- [def-specification.stage2.m.md](./def-specification.stage2.m.md).  To combine the specification with the table-of-contents.
- [ifex_ast.py](../ifex/model/ifex_ast.py) is the python source that is interpreted to produce `generated-syntax.md` which is later included as the Syntax chapter in the specification.
- [def-developers-manual.m.md](./def-developers-manual.m.md) lists the parts required to produce the developer documentation. (Work in progress)

## Build sequence

For developers manual:
- Generate `developers-manual.md` by concatenating multiple files, as specified in `def-developers-manual.m.md` (Work in progress)

For the main specification:
- Build `generated-syntax.md` from python source file.
- Stage 1: Concatenate files as specified in `def-specification.stage1.m.md` to produce temporary file (`generated-specification.stage1.md`)
- Build Table of Contents (ToC) stored in a temporary file (`generated-toc.md`)
- Stage 2: Build final `ifex-specification.md` by concatenating all ToC and specification-contents, in the order specified in `def-specification.stage2.m.md`

Deployment:
- The GitHub actions workflow goes on to commit the results to the [gh-pages branch](https://github.com/COVESA/ifex/tree/gh-pages) of the repository, which in turn makes it automatically published at [https://covesa.github.io/ifex](https://covesa.github.io/ifex)

## Testing new documentation
- This process can be followed to test changes to documentation before publishing them to the official pages, but since this will add commits to the official repo, do it sparingly and consider working on a fork as another option:
  - Include the word "deploy-docs" in the most recent commit message
  - Push the changes to a branch (normally via a PR first of course)
  - This will trigger a build of the documentation which will be stored on the gh-pages branch, under a subdirectory: `branch/<branchname>`.  The modified docs can be viewed on the GitHub pages by adding `branch/<branchname>` to any URL.

